This chapter provides an abridged overview of Moltres as a multiphysics
simulation software for molten salt reactors. 
Section \ref{sec:moltres-features}
describes general software features of Moltres, Section
\ref{sec:moltres-physics} expands on the physics models in Moltres, and Section
\ref{sec:moltres-previous} describes the current capabilities in Moltres.

\section{General Features} \label{sec:moltres-features}

This section discusses the general software features of Moltres. The
discussion specifically focuses on robustness, extensibility, and ease of use
as these characteristics represent the hallmarks of a good multiphysics
software \cite{keyes_multiphysics_2013}. These criteria also apply for
assessing \gls{MSR} simulation tools since the nonlinearity of \gls{MSR}
multiphysics analysis and the complexity of advanced reactor designs
necessitate robust, scalable, and flexible computational tools.

Moltres draws many advantages from being developed on MOOSE
\cite{permann_moose_2020}. MOOSE is an open-source, finite-element,
multiphysics framework developed at \gls{INL}. The framework provides a
user-friendly interface for developing multiphysics software through
\gls{OOP} in \texttt{C++} to modularize various
functions relevant to finite-element, multiphysics solvers. In this approach,
MOOSE and MOOSE-based applications break down \glspl{PDE} into individual terms
and store them as individual \texttt{C++ objects} referred to as
\texttt{Kernels}. These \texttt{Kernels} contain functions for calculating
their weak form residual and Jacobian
contributions and other relevant functions required to solve a given
\gls{PDE}. \gls{OOP} in MOOSE simplifies software development
since developers can write new \texttt{Kernels} as child classes in
\texttt{C++} derived from existing \texttt{Kernels} (base classes) which share
similar physics to inherit common functions.
The same philosophy applies for all other systems in MOOSE such as
the \texttt{BoundaryCondition}, \texttt{Materials}, and \texttt{Postprocessor}
systems for handling relevant boundary conditions, material properties, and
postprocessing calculations, respectively. Overall, this approach also saves
researchers time and effort as they are unencumbered by the technical details
and complexities involved in programming efficient computational tools for
numerical analysis.

\begin{figure}[htb!]
	\centering
	\includegraphics[width=.7\columnwidth]{moose}
	\caption{Structure of MOOSE and its dependencies.}
	\label{fig:moose}
\end{figure}

MOOSE relies on two other open-source libraries: libMesh
\cite{kirk_libmesh_2006} for its \gls{FEM} capabilities on
unstructured mesh, and PETSc \cite{satish_petsc_2019} for its non-linear
solvers and preconditioning routines. By extension, Moltres gains access to
these libraries for their \gls{PDE} solving capabilities. Figure
\ref{fig:moose} shows how MOOSE serves as an interface between physics
applications and libMesh/PETSc. MOOSE supports
modeling on up to three-dimensional (3-D) unstructured meshes for a wide range
of mesh file formats, including the commonly used Exodus II file format. For
2-D meshes, users can opt between Cartesian and polar RZ coordinates. MOOSE
also supports parallel computing through the \gls{MPI} library to leverage
modern high-performance computing for large multiphysics simulations.

Moltres benefits from the highly-integrated cross compatibility within the
ecosystem of MOOSE-based applications. MOOSE facilitates multiphysics coupling
among all MOOSE-based applications by providing a common framework for shared
data access and file input/output, thus eliminating computational costs from
data transfers and allowing for fully coupled solves. For example, Moltres
couples with the \texttt{Navier-Stokes} module \cite{peterson_overview_2018}
from MOOSE for fully coupled reactor simulations modeling neutronics and
thermal-hydraulics with incompressible flow. Section
\ref{sec:challenges} highlighted the advantages of using fully coupled schemes
for modeling strongly coupled systems such as the coupled
neutronics and thermal-hydraulics in \glspl{MSR}. Moltres can also
couple to other MOOSE-based applications in a similar fashion with ease. In
addition, MOOSE
provides the option for either tight or loose coupling through the
\texttt{MultiApp} system \cite{gaston_physics-based_2015}. Tight coupling
schemes can outperform fully coupled schemes in weakly coupled systems in which
the computational expenses of fully coupled schemes outweigh the savings from
running fewer Newton iterations due to the superior convergence rate. Loose
coupling schemes are useful for accelerating time-dependent simulations of
stable systems towards steady state in which only the steady-state
configuration is of interest to the user. This typically occurs in the later
stages \gls{MSR} simulations when the delayed neutron precursor concentrations
converge slowly due to their relatively large decay half-lives. Furthermore,
segregated solves through the \texttt{MultiApp} system enables Moltres to
introduce delayed neutron precursor drift and non-uniform temperature
distributions into criticality search simulations. Regardless of which
coupling scheme is best, MOOSE-based applications provide the flexibility
to switch among the schemes as users see fit. For time-dependent simulations,
MOOSE provides more than ten different implicit and explicit timestepping
schemes. The default, most common scheme is the first-order backward Euler
method which offers excellent solver stability for stiff \glspl{PDE}.

Lastly, Moltres is an open-source \gls{LGPL} software hosted on
GitHub \cite{github_build_2017}. Open-sourcing software provides ease of access
and expands the userbase. These characteristics promote software quality
through increased feedback on users' needs and transparency for peer review.
Open-source software accelerate research progress by supporting research
collaboration and sharing best software practices. Supporting Moltres'
continued development, Moltres relies on GitHub for online version control with
continuous integrated testing to protect its existing capabilities.

In summary, Moltres provides robust, yet flexible coupling capabilities to
model strongly coupled neutronics and thermal-hydraulics in \glspl{MSR}. As a
MOOSE-based application, Moltres is highly extensible by means of coupling to
other MOOSE-based applications and benefits from MOOSE's user-friendly
interface for software development and general ease of use.

\section{Physics Models} \label{sec:moltres-physics}

This section describes the various physics models available in Moltres to model
coupled neutronics and thermal-hydraulics in \glspl{MSR}.

\subsection{Neutronics}

\subsubsection{Multigroup Neutron Diffusion Equations}

Moltres solves the multigroup neutron diffusion equations for the neutron
flux solution within the problem domain. These equations are derived from the
neutron transport
equation in the diffusion-dominated limit with Fick's law of diffusion and
further simplified by discretizing the continuous neutron energy variable into
a finite number of energy groups. The time-dependent multigroup neutron
diffusion equations with $G$ energy groups and $I$ delayed neutron precursor
groups are given by:
%
\begin{align}
    \frac{1}{v_g} \frac{\partial \phi_g}{\partial t} =& \nabla \cdot D_g
    \nabla \phi_g - \Sigma^r_g \phi_g +
    \sum^G_{g' \neq g} \Sigma^s_{g' \rightarrow g} \phi_{g'} \nonumber \\
    &+ \chi^p_g \sum^G_{g'=1} \left( 1-\beta \right) \nu \Sigma^f_{g'}
    \phi_{g'} + \chi^d_g \sum^I_i \lambda_i C_i \label{eq:neutron} \\
    %
    \shortintertext{where}
    v_g =& \text{ average speed of neutrons in group $g$,} 
    \nonumber \\
    \phi_g =& \text{ neutron flux in group $g$,}
    \nonumber \\
    t =& \text{ time,} \nonumber \\
    D_g =& \text{ diffusion coefficient of neutrons in} \nonumber \\
    &\text{ group $g$,} \nonumber \\
    \Sigma^r_g =& \text{ macroscopic cross section for removal of} \nonumber \\
    &\text{ neutrons from group $g$,} \nonumber \\
    \Sigma^s_{g' \rightarrow g} =& \text{ macroscopic cross section of
    scattering from} \nonumber \\
    &\text{ groups $g'$ to $g$,} \nonumber \\
    \chi^p_g =& \text{ prompt fission spectrum for neutrons in} \nonumber \\
    &\text{ group $g$,} \nonumber \\
    G =& \text{ total number of discrete neutron groups,} \nonumber \\
    \nu_g =& \text{ average number of neutrons produced per} \nonumber \\
    &\text{ fission,} \nonumber \\
    \Sigma^f_{g} =& \text{ macroscopic fission cross section for neutron}
    \nonumber \\
    &\text{ in group $g$,} \nonumber \\
    \chi^d_g =& \text{ delayed fission spectrum for neutrons in} \nonumber \\
    &\text{ group $g$,} \nonumber \\
    I =& \text{ total number of delayed neutron precursor} \nonumber \\
    &\text{ groups,} \nonumber \\
    \beta =& \text{ total delayed neutron fraction.} \nonumber
\end{align}

In spite of forming only around 0.7\% of all neutrons emitted, delayed neutrons
play outsized roles in reactor kinetics. The relatively long half-lives of
delayed neutron precursors gives us ample time in adequately designed reactors
to control reactor power output and intervene in case of power excursions.
The precursor concentration balance equations for $I$ precursor
groups are given by:
%
\begin{align}
    \frac{\partial C_i}{\partial t} =& \beta_i \sum^G_{g'=1} \nu \Sigma^f_{g'}
    \phi_{g'} - \lambda_i C_i - \vec{u} \cdot \nabla C_i + \nabla \cdot
    D_{\text{P}} \nabla C_i \label{eq:precursor} \\
    %
    \shortintertext{where}
    \beta_i =& \text{ delayed neutron fraction of precursor group $i$,}
    \nonumber \\
    \lambda_i =& \text{ average decay constant of delayed neutron} \nonumber \\
    &\text{ precursors in precursor group $i$,} \nonumber \\
    C_i =& \text{ concentration of delayed neutron precursors in}
    \nonumber \\
    &\text{ precursor group $i$,} \nonumber \\
    \vec{u} =& \text{ molten salt flow velocity vector,}
    \nonumber \\
    D_{\text{P}} =& \text{ effective diffusion coefficient of the delayed}
    \nonumber \\
    &\text{ neutron precursors.} \nonumber
\end{align}

These two equations are largely similar to conventional formulations of the
multigroup neutron diffusion equations with delayed neutrons for most reactor
types. The only differences are in the last two terms in Equation \ref{eq:dnp}
which represent the advection and diffusion terms, respectively, to model the
movement of \gls{DNP} in liquid-fuel \glspl{MSR}.

As shown in Equations \ref{eq:neutron} and \ref{eq:precursor}, Moltres requires
group constant data from dedicated high-fidelity neutronics software such as
the NEWT module in SCALE \cite{dehart_reactor_2011}, Serpent
\cite{leppanen_serpent_2014}, or OpenMC \cite{romano_openmc:_2015}. These group
constant data are the neutron energy group $g$ values for $v_g$, $D_g$,
$\Sigma^r_g$, $\Sigma^s_{g' \rightarrow g}$, $\chi^p_g$, $\chi^d_g$,
$\Sigma^f_{g}$, and $\nu\Sigma^f_{g}$, and precursor group $i$ values for
$\beta_i$ and $\lambda_i$. Users
can run a Python script in Moltres' Github repository which automatically reads
user-provided SCALE/Serpent/OpenMC output data files and creates
Moltres-compatible JSON format files containing all required group constant
data. Moltres allows for an arbitrary number of neutron energy groups $G$ and
precursor groups $I$ as long as the user provides the necessary group constant
data. In practice, $I$ depends on the nuclear data library used to generate
group constants---the JEFF \cite{plompen_joint_2020} and ENDF
\cite{brown_endfb-viii0_2018} data libraries define eight precursor groups
and six precursor groups, respectively.

In multiphysics reactor simulations, we model the coupling between neutronics
and thermodynamics through temperature-dependent group constants. To sample
group constants at different temperatures in Moltres, users must provide group
constant data measured at more than one temperature (e.g. 800K--1500K at 100K
intervals). Users can then choose from linear spline, cubic spline, or monotone
cubic interpolation methods available in Moltres to interpolate the group
constant data for values falling within the provided temperature range. 

\subsubsection{Boundary Conditions}

Moltres provides two types of boundary conditions for neutron fluxes; these are
conventionally known as the vacuum and reflective boundary conditions given,
respectively, as:

\begin{align}
    \frac{\partial \phi}{\partial x_i} + \frac{\phi}{2} =& 0
    \shortintertext{and}
    \frac{\partial \phi}{\partial x_i} =& 0
    \shortintertext{where}
    x_i =& \mbox{ spatial coordinate perpendicular to the boundary.} \nonumber
\end{align}

The vacuum boundary condition typically applies to the external boundaries of
the reactor beyond which lies low-interaction media such as air, while the
reflective boundary condition is useful for exploiting symmetries in the
model geometry such as the axial boundary in axisymmetric geometries. The
reflective boundary condition is also equivalent to the more generally known
homogeneous Neumann boundary condition. Relevant boundary conditions for
delayed neutron precursors include the homogeneous Neumann boundary condition
along fuel salt-structural interfaces; and outflow/inflow boundary
conditions along the outlet/inlet boundaries through which the precursors
flow as they circulate the fuel salt loop.

\subsection{Thermal-Hydraulics}

\subsubsection{Temperature Advection-Diffusion}

\subsubsection{Incompressible Navier-Stokes Flow}

\subsubsection{Boundary Conditions}

\subsection{Precursor Loop}

\section{Previous Work} \label{sec:moltres-previous}

\subsection{MSRE}

\subsection{MSFR}

\subsection{CNRS Benchmark}

%\input{cnrs-benchmark/introduction}
\input{cnrs-benchmark/benchmark}
\input{cnrs-benchmark/moltres}
\input{cnrs-benchmark/results}
\input{cnrs-benchmark/conclusion}